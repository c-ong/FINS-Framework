LOCAL_DIR := $(PWD)

ifndef FINS_ROOT_DIR
FINS_ROOT_DIR := $(LOCAL_DIR)/../../..
export FINS_ROOT_DIR
endif

# fins.mk contains the compiler and linker options for each target platform
include $(FINS_ROOT_DIR)/settings.finsmk

#This name must be the same as the current directory!
MODULE_NAME = ipv4

#extra includes needed for FINS core modules
CFLAGS += $(CORE_MODULES_INC)

#This is the list of objects needed to build the FINS core. NOTE: object files
#that contain a "main" function must NOT be included in this list!!!
OBJS = IP4_checksum.o IP4_const_header.o IP4_dest_check.o IP4_exit.o IP4_forward.o IP4_fragment_data.o IP4_in.o IP4_init.o IP4_next_hop.o IP4_out.o IP4_reass.o IP4_receive_fdf.o IP4_route_info.o IP4_send_fdf.o ipv4.o 

#list any added executables here so they can be cleaned
EXECUTABLES = 

#This is an autogenerated list of includes used in this project
INCLUDES = $(foreach DIR_NAME, $(subst -I,, $(strip $(CORE_MODULES_INC))), $(addprefix $(DIR_NAME)/, $(shell ls $(DIR_NAME)| grep \\.h)))



##### TARGETS #####
.PHONY:all
all: $(MODULE_NAME)
	@echo "$(MODULE_NAME) is compiled\n"

$(MODULE_NAME):$(OBJS)
	@echo $(addprefix "$(shell pwd)/", $(OBJS)) > OBJS.finsmk 

%.o:%.c $(INCLUDES)
	@$(CC) $(CFLAGS) -c $< -o $@	

.PHONY:clean
clean:
	@rm -f *.o
	@rm -f $(EXECUTABLES)
	@rm -f OBJS.finsmk
