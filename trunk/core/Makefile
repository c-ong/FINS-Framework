LOCAL_DIR := $(PWD)

ifndef FINS_ROOT_DIR
FINS_ROOT_DIR := $(LOCAL_DIR)/../..
export FINS_ROOT_DIR
endif

# fins.mk contains the compiler and linker options for each target platform
include $(FINS_ROOT_DIR)/settings.finsmk

#This is the name of the FINS core executable
PROJECT_NAME = core

#These are the extra includes for the FINS core modules.
CFLAGS += $(FINS_CORE_INC)

#These are the objects from each module that must be linked to create the FINS core module
OBJS = $(COMMON_OBJS) $(foreach module, $(CORE_MODULE_LIST), $(shell cat $(module)/OBJS.finsmk)) core.o 

#This is an autogenerated list of includes used in this project.
INCLUDES = $(foreach DIR_NAME, $(subst -I,, $(strip $(FINS_CORE_INC))), $(addprefix $(DIR_NAME)/, $(shell ls $(DIR_NAME)| grep \\.h)))



##### TARGETS #####
.PHONY:all
all:$(PROJECT_NAME)
	@echo "$(PROJECT_NAME) is compiled\n"

$(PROJECT_NAME):modules core.o
	@$(LD) $(LDFLAGS) $(OBJS) -o $@

.PHONY:modules
modules:
	@$(foreach module,$(CORE_MODULE_LIST), cd $(module); $(MAKE) all; cd ../;)


%.o:%.c $(INCLUDES)
	@$(CC) $(CFLAGS) -c $< -o $@

.PHONY:clean
clean:
	@$(foreach module,$(CORE_MODULE_LIST), cd $(module); $(MAKE) clean; cd ../;)
	@rm -f $(PROJECT_NAME)
	@rm -f *.o


